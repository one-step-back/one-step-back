import{j as e}from"../util/alert.min.js";import{S as l}from"../util/toast.min.js";e(()=>{const b=e("#joinForm"),o=e("#email"),f=e("#rawPassword"),k=e("#passwordCheck"),$=e("#nickname"),C=e("#profileImage"),m=e("#profile-preview"),v=e("#btn-check-email"),t={email:!1,password:!1,passwordCheck:!1,nickname:!1},u={email:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/i,password:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@!%*#?&])[A-Za-z\d$@!%*#?&]{8,20}$/,nickname:/^[가-힣a-zA-Z0-9]{2,10}$/};m.on("click",()=>{C.trigger("click")}),C.on("change",s=>{const r=s.target.files?.[0];if(r){const n=new FileReader;n.onload=c=>{const p=c.target?.result;m.empty().css({"background-image":`url('${p}')`,"background-size":"cover","background-position":"center",border:"none"})},n.readAsDataURL(r)}else m.empty().append('<i class="fas fa-camera"></i>').css({"background-image":"none",border:"2px dashed #e1e1e1"})}),v.on("click",()=>{const s=o.val(),a=e("#email-msg");if(!s){i(o,a,"이메일을 입력해주세요.");return}if(!u.email.test(s)){i(o,a,"올바른 이메일 형식이 아닙니다.");return}e.ajax({url:"/api/v1/members/check-email",type:"GET",data:{email:s},success:r=>{r.success&&r.data===!0?(d(o,a,"사용 가능한 이메일입니다."),t.email=!0,o.prop("readonly",!0).addClass("readonly-input"),v.text("확인완료").prop("disabled",!0)):(i(o,a,"이미 사용 중인 이메일입니다."),t.email=!1)},error:()=>{l.error("서버 통신 중 오류가 발생했습니다."),t.email=!1}})}),f.on("input",function(){const s=e(this).val(),a=e("#rawPassword-msg");u.password.test(s)?(d(e(this),a,"사용 가능한 비밀번호입니다."),t.password=!0):(i(e(this),a,"영문, 숫자, 특수문자 포함 8~20자"),t.password=!1),k.trigger("input")}),k.on("input",function(){const s=e(this).val(),a=f.val(),r=e("#password-check-msg");if(!s){r.text(""),t.passwordCheck=!1;return}s!==a?(i(e(this),r,"비밀번호가 일치하지 않습니다."),t.passwordCheck=!1):(d(e(this),r,"비밀번호가 일치합니다."),t.passwordCheck=!0)}),$.on("input",function(){const s=e(this).val(),a=e("#nickname-msg");u.nickname.test(s)?(d(e(this),a,"멋진 닉네임이네요!"),t.nickname=!0):(i(e(this),a,"한글, 영문, 숫자 포함 2~10자"),t.nickname=!1)}),b.on("submit",s=>{if(s.preventDefault(),!x())return;const a=new FormData(s.currentTarget);e.ajax({url:"/api/v1/members/join",type:"POST",data:a,processData:!1,contentType:!1,success:r=>{r.success?window.location.href="/member/login?join=true":r.error&&A(r.error)},error:r=>{console.error("Join Error:",r),l.error("시스템 오류가 발생했습니다. 관리자에게 문의하세요.")}})});function i(s,a,r){s.addClass("field-error-border").removeClass("field-success-border"),a.text(r).addClass("field-error").removeClass("field-success")}function d(s,a,r){s.removeClass("field-error-border").addClass("field-success-border"),a.text(r).removeClass("field-error").addClass("field-success")}function x(){return t.email?!t.password||!t.passwordCheck?(l.error("비밀번호를 확인해주세요."),f.trigger("focus"),!1):t.nickname?!0:(l.error("닉네임을 확인해주세요."),$.trigger("focus"),!1):(l.error("이메일 중복 확인을 해주세요."),o.trigger("focus"),!1)}function A(s){if(s.code==="VAL-001"){const a=/\[(.*?): (.*?)]/g;let r,n=null;for(;(r=a.exec(s.message))!==null;){const c=r[1],p=r[2];let g=c,w=c+"-msg";c==="rawPassword"?(g="rawPassword",w="rawPassword-msg"):c==="passwordCheck"&&(g="passwordCheck",w="password-check-msg");const h=e("#"+g),I=e("#"+w);h.length&&(i(h,I,p),n||(n=h))}n&&n.trigger("focus")}else s.code==="MEM-002"?(i(o,e("#email-msg"),s.message),t.email=!1,o.trigger("focus")):l.error(s.message)}});
