import{j as r}from"../util/alert.min.js";import{S as h}from"../util/toast.min.js";r(()=>{const a=r("#funding-list"),g=r("#funding-empty"),f=r("#funding-loading");let o=null,i=!1,c=!0;const y=t=>Number(t).toLocaleString(),$=t=>{let s;Array.isArray(t)?s=new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0):s=new Date(t);const e=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),l=String(s.getDate()).padStart(2,"0"),d=String(s.getHours()).padStart(2,"0"),u=String(s.getMinutes()).padStart(2,"0");return`${e}.${n}.${l} ${d}:${u}`},m=()=>{if(i||!c)return;i=!0,f.show();const t={size:5};o!==null&&(t.lastPaymentId=o),r.ajax({url:"/api/v1/crowd-funding/my-history",type:"GET",data:t,success:s=>{if(s.success&&s.data){const e=s.data;c=e.hasNext;const n=e.content;n&&n.length>0?(o=n[n.length-1].paymentId,S(n)):o===null&&(a.hide(),g.show())}else{const e=s.error?.message||"데이터를 불러오는 중 오류가 발생했습니다.";h.error(e)}},error:()=>{h.error("서버와의 통신에 실패했습니다.")},complete:()=>{i=!1,f.hide()}})},p=new IntersectionObserver(t=>{t[0].isIntersecting&&c&&!i&&m()},{threshold:.5}),S=t=>{g.hide(),a.show();const s=a.children().last();s.length&&p.unobserve(s[0]),t.forEach(n=>{const l=n.status==="PAID",d=l?"status-paid":"status-refunded",u=l?"결제 완료":"환불 완료",I=`/artist/${n.artistId}/funding/${n.fundingId}`,v=`
                <li class="funding-card">
                    <div class="card-info">
                        <span class="artist-name">${n.artistName}</span>
                        <a href="${I}" class="funding-title">${n.title}</a>
                        <span class="payment-date">결제일: ${$(n.paymentDate)}</span>
                    </div>
                    <div class="card-amount-status">
                        <span class="payment-amount">${y(n.amount)}원</span>
                        <span class="status-badge ${d}">${u}</span>
                    </div>
                </li>
            `;a.append(v)});const e=a.children().last();e.length&&c&&p.observe(e[0])};m()});
