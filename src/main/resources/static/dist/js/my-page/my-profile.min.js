import{j as e}from"../util/alert.min.js";import{S as m}from"../util/toast.min.js";import{C as p}from"../util/confirm.min.js";e(()=>{const g=e("#profileImage"),n=e("#profilePreview"),w=e("#profileForm"),u=e("#btnUpdateProfile");e("#passwordForm");const b=e("#btnUpdatePassword"),h=e("#btnWithdraw");g.on("change",s=>{const o=s.target.files?.[0];if(o){const r=new FileReader;r.onload=l=>{const a=l.target?.result;n.css("background-image",`url(${a})`)},r.readAsDataURL(o)}}),u.on("click",()=>{const s=w[0],t=new FormData(s);e(".field-error-border").removeClass("field-error-border"),e.ajax({url:"/api/v1/members/update",type:"PATCH",data:t,processData:!1,contentType:!1,success:()=>{m.success("프로필이 성공적으로 수정되었습니다."),setTimeout(()=>location.reload(),1e3)},error:o=>{c(o,"프로필 수정에 실패했습니다.")}})}),b.on("click",()=>{const s={currentPassword:e("#currentPassword").val(),newPassword:e("#newPassword").val()};e(".field-error-border").removeClass("field-error-border"),e(".field-error").hide().text(""),e.ajax({url:"/api/v1/members/password",type:"PATCH",data:JSON.stringify(s),processData:!1,contentType:"application/json",success:()=>{p.open({title:"비밀번호 변경 완료",desc:"비밀번호가 변경되었습니다. 다시 로그인해주세요.",actionText:"로그인 이동",onConfirm:()=>{location.href="/member/login"}})},error:t=>{c(t,"비밀번호 변경에 실패했습니다.")}})}),h.on("click",()=>{p.open({title:"회원 탈퇴",desc:"정말로 탈퇴하시겠습니까? 탈퇴 시 모든 데이터가 즉시 삭제되며 복구가 불가능합니다.",actionText:"탈퇴하기",onConfirm:()=>{e.ajax({url:"/api/v1/members/withdraw",type:"DELETE",success:()=>{alert("탈퇴 처리되었습니다. 그동안 이용해주셔서 감사합니다."),location.href="/"},error:()=>{alert("탈퇴 처리 중 오류가 발생했습니다.")}})}})});function c(s,t){let o=t;const r=s.responseJSON;if(r?.error?.code==="VAL-001"){const l=/\[(.*?): (.*?)]/g;let a,d=!0;for(;(a=l.exec(r.error.message))!==null;){const i=a[1],f=a[2];i==="profileImage"?n.addClass("field-error-border"):e(`#${i}`).addClass("field-error-border"),e(`#error-${i}`).text(f).show(),d&&(o=f,i!=="profileImage"&&e(`#${i}`).trigger("focus"),d=!1)}}else r?.error?.message?o=r.error.message:r&&r.message&&(o=r.message);m.error(o)}});
