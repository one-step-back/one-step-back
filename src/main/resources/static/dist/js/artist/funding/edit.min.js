import{j as t}from"../../util/alert.min.js";import{S as i}from"../../util/toast.min.js";import{f as T,k as w}from"../../../ko.min.js";t(()=>{const h=t("#funding-form"),d=t("#file-input"),$=t("#preview-img"),D=t(".upload-placeholder"),g=t(".img-upload-box"),c=t("#targetAmount"),p=t("#originalFileId").val();let u=p?parseInt(p,10):null;const f=c.val().replace(/[^0-9]/g,"");f&&c.val(Number(f).toLocaleString()),c.on("input",e=>{const r=t(e.currentTarget),a=(r.val()||"").replace(/[^0-9]/g,"");a?r.val(Number(a).toLocaleString()):r.val("")}),t("#dateRange").length>0&&T("#dateRange",{mode:"range",dateFormat:"Y-m-d",locale:w.Korean,minDate:"today",showMonths:1,onChange:(e,r,a)=>{if(e.length===2){const o=a.formatDate(e[0],"Y-m-d"),n=a.formatDate(e[1],"Y-m-d");t("#startDate").val(o),t("#endDate").val(n);const s=Math.abs(e[1].getTime()-e[0].getTime()),l=Math.ceil(s/(1e3*60*60*24))+1;t("#date-help-text").text(`총 ${l}일 동안 진행됩니다. (${o} ~ ${n})`).css("color","#2563eb")}else t("#date-help-text").text("시작일과 종료일을 모두 선택해주세요.").css("color","#64748b"),t("#startDate").val(""),t("#endDate").val("")}}),d.on("click",e=>e.stopPropagation()),g.on("click",()=>{d.trigger("click")}),d.on("change",e=>{const a=e.currentTarget.files?.[0];if(!a)return;const o=new FormData;o.append("file",a),t.ajax({url:"/api/v1/files/upload",type:"POST",data:o,processData:!1,contentType:!1,success:n=>{u=n.data?.id||n.id;const s=new FileReader;s.onload=l=>{$.attr("src",l.target?.result).show(),D.hide(),g.addClass("has-image")},s.readAsDataURL(a),i.success("이미지가 업로드되었습니다.")},error:()=>{i.error("이미지 업로드에 실패했습니다.")}})}),h.on("submit",e=>{e.preventDefault();const r=t("#fundingId").val(),a=t("#artistId").val(),o=t("#title").val().trim(),n=t("#content").val().trim(),s=c.val().replace(/,/g,""),l=t("#startDate").val(),m=t("#endDate").val();if(!o){i.error("프로젝트 제목을 입력해주세요."),t("#title").trigger("focus");return}if(!s||parseInt(s,10)<1e3){i.error("목표 금액은 최소 1,000원 이상이어야 합니다."),c.trigger("focus");return}if(!l||!m){i.error("진행 기간을 반드시 선택해야 합니다."),t("#dateRange").trigger("focus");return}if(!n){i.error("상세 내용을 입력해주세요."),t("#content").trigger("focus");return}const I={title:o,content:n,targetAmount:parseInt(s,10),startDate:l,endDate:m,fileId:u},v=t(".btn-submit");v.prop("disabled",!0).text("오픈 중..."),t.ajax({url:`/api/v1/crowd-funding/${r}/edit-accept`,type:"PATCH",contentType:"application/json",data:JSON.stringify(I),success:()=>{i.success("성공적으로 수정 및 오픈되었습니다."),setTimeout(()=>{location.href=`/artist/${a}/funding/${r}`},1e3)},error:b=>{const x=b.responseJSON;i.error(x?.error?.message||"오픈 실패"),v.prop("disabled",!1).text("수정 후 펀딩 오픈하기")}})})});
