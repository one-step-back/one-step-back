import{j as t}from"../../util/alert.min.js";import{S as r}from"../../util/toast.min.js";import{C as b}from"../../util/confirm.min.js";t(()=>{const p=t("#artistId").val(),s=t("#fundingId").val(),g=t(".progress-fill"),m=g.data("width");setTimeout(()=>{g.css("width",m+"%")},300),t(".btn-share").on("click",()=>{const e=window.location.href;navigator.clipboard.writeText(e).then(()=>{r.success("링크가 복사되었습니다.")}).catch(()=>{r.error("링크 복사에 실패했습니다.")})});const u=t("#fundingAmount");u.on("input",e=>{const n=t(e.currentTarget),o=(n.val()||"").replace(/[^0-9]/g,"");o?n.val(Number(o).toLocaleString()):n.val("")}),t("#btn-fund").on("click",()=>{const e=u.val().replace(/,/g,""),n=parseInt(e||"0",10);if(n<1e3){r.error("최소 1,000원 이상 후원 가능합니다."),u.trigger("focus");return}location.href=`/artist/${p}/funding/${s}/payment?amount=${n}`});const c=t("#reject-modal"),a=t("#rejectReasonInput");t("#btnRejectFunding").on("click",()=>{a.val(""),c.css("display","flex").hide().fadeIn(200),setTimeout(()=>a.trigger("focus"),200)}),t("#reject-cancel-btn").on("click",()=>{c.fadeOut(200)}),c.on("click",e=>{t(e.target).is(c)}),t("#reject-action-btn").on("click",function(e){const n=a.val().trim();if(!n){r.error("반려 사유를 입력해주세요."),a.trigger("focus");return}const o=t(e.currentTarget);o.prop("disabled",!0).text("처리 중..."),t.ajax({url:`/api/v1/crowd-funding/${s}/reject`,type:"PATCH",contentType:"application/json",data:JSON.stringify({rejectReason:n}),success:()=>{r.success("반려 처리되었습니다."),setTimeout(()=>location.reload(),1e3)},error:d=>{const f=d.responseJSON;r.error(f?.error?.message||"처리 중 오류가 발생했습니다."),o.prop("disabled",!1).text("반려하기")}})}),t("#btnAcceptFunding").on("click",()=>{location.href=`/artist/${p}/funding/${s}/edit`}),t("#btnSuccessFunding").on("click",()=>{b.open({title:"펀딩 성공 처리",desc:"펀딩을 성공으로 처리하시겠습니까? 결제가 확정되며 후원금이 수익으로 이관됩니다. 이 작업은 되돌릴 수 없습니다.",actionText:"성공으로 처리",onConfirm:()=>{const e=t("#btnSuccessFunding");e.prop("disabled",!0).text("처리 중..."),t.ajax({url:`/api/v1/crowd-funding/${s}/success`,type:"PATCH",success:()=>{r.success("성공적으로 펀딩이 마감되었습니다."),setTimeout(()=>location.reload(),1e3)},error:n=>{const o=n.responseJSON;r.error(o?.error?.message||"성공 처리에 실패했습니다."),e.prop("disabled",!1).text("성공 (진행)")}})}})});const i=t("#fail-modal"),l=t("#failReasonInput");t("#btnFailFunding").on("click",()=>{l.val(""),i.css("display","flex").hide().fadeIn(200),setTimeout(()=>l.trigger("focus"),200)}),t("#fail-cancel-btn").on("click",()=>{i.fadeOut(200)}),i.on("click",e=>{t(e.target).is(i)}),t("#fail-action-btn").on("click",function(e){const n=l.val().trim();if(!n){r.error("실패(환불) 사유를 반드시 입력해주세요."),l.trigger("focus");return}const o=t(e.currentTarget);o.prop("disabled",!0).text("환불 진행 중..."),t.ajax({url:`/api/v1/crowd-funding/${s}/fail`,type:"PATCH",contentType:"application/json",data:JSON.stringify({rejectReason:n}),success:()=>{r.success("펀딩이 실패 처리되고 전액 환불되었습니다."),setTimeout(()=>location.reload(),1500)},error:d=>{const f=d.responseJSON;r.error(f?.error?.message||"처리 중 오류가 발생했습니다."),o.prop("disabled",!1).text("전액 환불하기")}})})});
