import{j as t}from"../../util/alert.min.js";import{S as i}from"../../util/toast.min.js";import{f as T,k as w}from"../../../ko.min.js";t(()=>{const v=t("#funding-form"),c=t("#file-input"),g=t("#preview-img"),m=t(".upload-placeholder"),d=t(".img-upload-box"),f=t("#targetAmount"),x=t("#isArtist").val()==="true",h=t("#artistId").val();let p=null;f.on("input",e=>{const n=t(e.currentTarget);let a=(n.val()||"").replace(/[^0-9]/g,"");a?n.val(Number(a).toLocaleString()):n.val("")}),t("#dateRange").length>0&&T("#dateRange",{mode:"range",dateFormat:"Y-m-d",locale:w.Korean,minDate:"today",showMonths:1,onChange:(e,n,a)=>{if(e.length===2){const r=a.formatDate(e[0],"Y-m-d"),o=a.formatDate(e[1],"Y-m-d");t("#startDate").val(r),t("#endDate").val(o);const s=Math.abs(e[1].getTime()-e[0].getTime()),l=Math.ceil(s/(1e3*60*60*24))+1;t("#date-help-text").text(`총 ${l}일 동안 진행됩니다. (${r} ~ ${o})`).css("color","#2563eb")}else t("#date-help-text").text("시작일과 종료일을 모두 선택해주세요.").css("color","#64748b")}}),c.on("click",e=>e.stopPropagation()),d.on("click",()=>{c.trigger("click")}),c.on("change",e=>{const a=e.currentTarget.files?.[0];if(!a)return;const r=new FormData;r.append("file",a),t.ajax({url:"/api/v1/files/upload",type:"POST",data:r,processData:!1,contentType:!1,success:o=>{p=o.data?.id||o.id;const s=new FileReader;s.onload=l=>{g.attr("src",l.target?.result).show(),m.hide(),d.addClass("has-image")},s.readAsDataURL(a),i.success("이미지가 업로드되었습니다.")},error:()=>{i.error("이미지 업로드에 실패했습니다."),c.val(""),g.hide(),m.show(),d.removeClass("has-image"),p=null}})}),v.on("submit",e=>{e.preventDefault();const n=t("#title").val().trim(),a=t("#content").val().trim(),r=f.val().replace(/,/g,"");let o=null,s=null;if(!n){i.error("프로젝트 제목을 입력해주세요."),t("#title").trigger("focus");return}if(!r||parseInt(r,10)<1e3){i.error("목표 금액은 최소 1,000원 이상이어야 합니다."),f.trigger("focus");return}if(x&&(o=t("#startDate").val(),s=t("#endDate").val(),!o||!s)){i.error("진행 기간을 정확히 선택해주세요.");return}if(!a){i.error("상세 내용을 입력해주세요."),t("#content").trigger("focus");return}const l={artistId:h,title:n,content:a,targetAmount:parseInt(r,10),startDate:o,endDate:s,fileId:p},u=t(".btn-submit"),$=u.text();u.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> 개설 중...'),t.ajax({url:"/api/v1/crowd-funding",type:"POST",contentType:"application/json",data:JSON.stringify(l),success:()=>{i.success("펀딩이 성공적으로 생성되었습니다."),setTimeout(()=>{location.href=`/artist/${h}/funding`},1e3)},error:b=>{const D=b.responseJSON?.error?.message||"생성 실패";i.error(D),u.prop("disabled",!1).text($)}})})});
