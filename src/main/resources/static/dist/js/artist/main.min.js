import{j as o}from"../util/alert.min.js";import{S as e}from"../util/toast.min.js";o(()=>{const u=o("body").data("member-id"),m={FOLLOW:"/api/v1/follows/",MEMBER_INFO:"/api/v1/members/info/"},p={LOGIN:"/member/login-email"},_={CONFETTI_DURATION:800,REDIRECT_DELAY:1e3},r=o("#btn-follow"),l=o("#artist-follower-count"),v=o("#share-modal"),I=o("#btn-share"),h=o(".artist-modal__close-btn, .artist-modal__backdrop"),C=o(".artist-input-group__field"),T=o(".artist-input-group__btn"),S=o("#btn-profile-info"),s=o("#profile-info-card");function w(){r.length&&r.on("click",L)}function L(t){const a=o(t.currentTarget),i=a.data("id"),E=a.data("status");if(!u){e.error("로그인이 필요한 서비스입니다."),setTimeout(()=>location.href=p.LOGIN,_.REDIRECT_DELAY);return}const c=!E,P=l.text().replace(/,/g,""),d=parseInt(P,10)||0;c?(f(!0),$(a),l.text((d+1).toLocaleString()),e.success("아티스트를 팔로우합니다!")):(f(!1),d>0&&l.text((d-1).toLocaleString()),e.info("팔로우를 취소했습니다."));const A=c?"POST":"DELETE";o.ajax({url:m.FOLLOW+i,type:A,success:()=>{u&&o(document).trigger("artist:nav-update")},error:B=>{O(B,c,d)}})}function O(t,a,i){if(console.error("[Follow] Request failed:",t),t.status===401)e.error("로그인이 필요합니다."),location.href=p.LOGIN;else{const c=t.responseJSON?.error?.message||"오류가 발생했습니다. 다시 시도해주세요.";e.error(c)}f(!a),l.text(i.toLocaleString())}function f(t){r.data("status",t),t?(r.removeClass("artist-btn--primary").addClass("artist-btn--active"),r.find("span").text("팔로잉")):(r.removeClass("artist-btn--active").addClass("artist-btn--primary"),r.find("span").text("팔로우"))}function $(t){t.addClass("artist-btn--animate"),setTimeout(()=>{t.removeClass("artist-btn--animate")},_.CONFETTI_DURATION)}function y(){I.on("click",R),h.on("click",g),T.on("click",F)}function R(){C.val(window.location.href),v.addClass("artist-modal--open")}function g(){v.removeClass("artist-modal--open")}function F(){C.trigger("select");try{document.execCommand("copy"),e.success("주소가 복사되었습니다.")}catch{e.error("복사에 실패했습니다.")}g()}let b=!1;const n="artist-profile__info-card--active";function N(){o(document).on("click",t=>{o(t.target).closest(".artist-profile__avatar-area").length||s.removeClass(n)}),S.on("click",k)}function k(t){t.stopPropagation();const i=o(t.currentTarget).data("id");if(s.hasClass(n)){s.removeClass(n);return}if(b){s.addClass(n);return}M(i)}function M(t){o.ajax({url:m.MEMBER_INFO+t,type:"GET",success:a=>{a.success&&a.data?x(a.data):e.error("정보를 불러오지 못했습니다.")},error:()=>{e.error("서버 통신 오류가 발생했습니다.")}})}function x(t){const a=`
            <div class="info-card__row">
                <span class="info-card__label">이메일</span>
                <div class="info-card__value">${t.email}</div>
            </div>
            <div class="info-card__row">
                <span class="info-card__label">닉네임</span>
                <div class="info-card__value">${t.nickname}</div>
            </div>
            <div class="info-card__row">
                <span class="info-card__label">소개</span>
                <div class="info-card__value" style="font-size: 14px; color: #666;">
                    ${t.description?t.description:"소개글이 없습니다."}
                </div>
            </div>
        `;s.html(a),s.addClass(n),b=!0}w(),y(),N()});
