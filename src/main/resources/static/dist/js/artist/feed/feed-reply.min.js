import{a as U,j as s}from"../../util/alert.min.js";import{S as I}from"../../util/toast.min.js";import{C as B}from"../../util/confirm.min.js";import{t as A}from"../../util/timeUtil.min.js";import{g as V}from"../../../_commonjsHelpers.min.js";var J={exports:{}};const Z=V(U);var L,F;function K(){if(F)return L;F=1;const{jQuery:T}=Z;return L=T,L}var X=J.exports,z;function Y(){return z||(z=1,(function(T,N){(function(u,x){T.exports=x(K())})(X,function(u,x){var O="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",M={},H=M.toString,P=/^([\-+])=\s*(\d+\.?\d*)/,k=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?(parseInt(e[4],16)/255).toFixed(2):1]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),e[4]?(parseInt(e[4]+e[4],16)/255).toFixed(2):1]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],f=u.Color=function(e,o,t,n){return new u.Color.fn.parse(e,o,t,n)},g={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},j={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},v,h=u.each;h(g,function(e,o){o.cache="_"+e,o.props.alpha={idx:3,type:"percent",def:1}}),u.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,o){M["[object "+o+"]"]=o.toLowerCase()});function $(e){return e==null?e+"":typeof e=="object"?M[H.call(e)]||"object":typeof e}function w(e,o,t){var n=j[o.type]||{};return e==null?t||!o.def?null:o.def:(e=n.floor?~~e:parseFloat(e),n.mod?(e+n.mod)%n.mod:Math.min(n.max,Math.max(0,e)))}function _(e){var o=f(),t=o._rgba=[];return e=e.toLowerCase(),h(k,function(n,r){var i,a=r.re.exec(e),l=a&&r.parse(a),c=r.space||"rgba";if(l)return i=o[c](l),o[g[c].cache]=i[g[c].cache],t=o._rgba=i._rgba,!1}),t.length?(t.join()==="0,0,0,0"&&u.extend(t,v.transparent),o):v[e]}f.fn=u.extend(f.prototype,{parse:function(e,o,t,n){if(e===x)return this._rgba=[null,null,null,null],this;(e.jquery||e.nodeType)&&(e=u(e).css(o),o=x);var r=this,i=$(e),a=this._rgba=[];if(o!==x&&(e=[e,o,t,n],i="array"),i==="string")return this.parse(_(e)||v._default);if(i==="array")return h(g.rgba.props,function(l,c){a[c.idx]=w(e[c.idx],c)}),this;if(i==="object")return e instanceof f?h(g,function(l,c){e[c.cache]&&(r[c.cache]=e[c.cache].slice())}):h(g,function(l,c){var p=c.cache;h(c.props,function(d,m){if(!r[p]&&c.to){if(d==="alpha"||e[d]==null)return;r[p]=c.to(r._rgba)}r[p][m.idx]=w(e[d],m,!0)}),r[p]&&u.inArray(null,r[p].slice(0,3))<0&&(r[p][3]==null&&(r[p][3]=1),c.from&&(r._rgba=c.from(r[p])))}),this},is:function(e){var o=f(e),t=!0,n=this;return h(g,function(r,i){var a,l=o[i.cache];return l&&(a=n[i.cache]||i.to&&i.to(n._rgba)||[],h(i.props,function(c,p){if(l[p.idx]!=null)return t=l[p.idx]===a[p.idx],t})),t}),t},_space:function(){var e=[],o=this;return h(g,function(t,n){o[n.cache]&&e.push(t)}),e.pop()},transition:function(e,o){var t=f(e),n=t._space(),r=g[n],i=this.alpha()===0?f("transparent"):this,a=i[r.cache]||r.to(i._rgba),l=a.slice();return t=t[r.cache],h(r.props,function(c,p){var d=p.idx,m=a[d],b=t[d],y=j[p.type]||{};b!==null&&(m===null?l[d]=b:(y.mod&&(b-m>y.mod/2?m+=y.mod:m-b>y.mod/2&&(m-=y.mod)),l[d]=w((b-m)*o+m,p)))}),this[n](l)},blend:function(e){if(this._rgba[3]===1)return this;var o=this._rgba.slice(),t=o.pop(),n=f(e)._rgba;return f(u.map(o,function(r,i){return(1-t)*n[i]+t*r}))},toRgbaString:function(){var e="rgba(",o=u.map(this._rgba,function(t,n){return t??(n>2?1:0)});return o[3]===1&&(o.pop(),e="rgb("),e+o.join(", ")+")"},toHslaString:function(){var e="hsla(",o=u.map(this.hsla(),function(t,n){return t==null&&(t=n>2?1:0),n&&n<3&&(t=Math.round(t*100)+"%"),t});return o[3]===1&&(o.pop(),e="hsl("),e+o.join(", ")+")"},toHexString:function(e){var o=this._rgba.slice(),t=o.pop();return e&&o.push(~~(t*255)),"#"+u.map(o,function(n){return("0"+(n||0).toString(16)).substr(-2)}).join("")},toString:function(){return this.toRgbaString()}}),f.fn.parse.prototype=f.fn;function q(e,o,t){return t=(t+1)%1,t*6<1?e+(o-e)*t*6:t*2<1?o:t*3<2?e+(o-e)*(2/3-t)*6:e}g.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var o=e[0]/255,t=e[1]/255,n=e[2]/255,r=e[3],i=Math.max(o,t,n),a=Math.min(o,t,n),l=i-a,c=i+a,p=c*.5,d,m;return a===i?d=0:o===i?d=60*(t-n)/l+360:t===i?d=60*(n-o)/l+120:d=60*(o-t)/l+240,l===0?m=0:p<=.5?m=l/c:m=l/(2-c),[Math.round(d)%360,m,p,r??1]},g.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var o=e[0]/360,t=e[1],n=e[2],r=e[3],i=n<=.5?n*(1+t):n+t-n*t,a=2*n-i;return[Math.round(q(a,i,o+1/3)*255),Math.round(q(a,i,o)*255),Math.round(q(a,i,o-1/3)*255),r]},h(g,function(e,o){var t=o.props,n=o.cache,r=o.to,i=o.from;f.fn[e]=function(a){if(r&&!this[n]&&(this[n]=r(this._rgba)),a===x)return this[n].slice();var l,c=$(a),p=c==="array"||c==="object"?a:arguments,d=this[n].slice();return h(t,function(m,b){var y=p[c==="object"?m:b.idx];y==null&&(y=d[b.idx]),d[b.idx]=w(y,b)}),i?(l=f(i(d)),l[n]=d,l):f(d)},h(t,function(a,l){f.fn[a]||(f.fn[a]=function(c){var p,d,m,b,y=$(c);return a==="alpha"?b=this._hsla?"hsla":"rgba":b=e,p=this[b](),d=p[l.idx],y==="undefined"?d:(y==="function"&&(c=c.call(this,d),y=$(c)),c==null&&l.empty?this:(y==="string"&&(m=P.exec(c),m&&(c=d+parseFloat(m[2])*(m[1]==="+"?1:-1))),p[l.idx]=c,this[b](p)))})})}),f.hook=function(e){var o=e.split(" ");h(o,function(t,n){u.cssHooks[n]={set:function(r,i){var a;i!=="transparent"&&($(i)!=="string"||(a=_(i)))&&(i=f(a||i),i=i.toRgbaString()),r.style[n]=i}},u.fx.step[n]=function(r){r.colorInit||(r.start=f(r.elem,n),r.end=f(r.end),r.colorInit=!0),u.cssHooks[n].set(r.elem,r.start.transition(r.end,r.pos))}})},f.hook(O),u.cssHooks.borderColor={expand:function(e){var o={};return h(["Top","Right","Bottom","Left"],function(t,n){o["border"+n+"Color"]=e}),o}},v=u.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})})(J)),J.exports}Y();function rt(){const T=s("#feed-main-container"),N=s("#reply-list"),u=s("#btn-reply-more"),x=s("#reply-content"),O=s("#btn-reply-write"),M=s("#reply-count-badge"),H=T.data("feed-id"),P=T.data("artist-id"),k=s("body").data("member-id"),f=s("#current-user-info"),g=f.data("member-nickname"),j=f.data("member-profile");let v=null;const h=10;let $=!0,w=!1;if(!k)return;const _=t=>{const n=parseInt(M.text(),10)||0,r=Math.max(0,n+t);M.text(r)},q=t=>{const n=t.memberId===k,r=A(t.createdTime),i=t.updatedTime&&JSON.stringify(t.createdTime)!==JSON.stringify(t.updatedTime)?'<span class="edited-badge">(수정됨)</span>':"",a=n?`<button type="button" class="btn-action btn-comment-edit">수정</button>
               <button type="button" class="btn-action btn-delete btn-comment-delete">삭제</button>`:"";return`
            <div class="comment-item" data-comment-id="${t.id}" data-member-id="${t.memberId}">
                <a href="/artist/${t.memberId}" class="comment-profile"><img src="${t.memberProfile}" alt="프사"></a>
                <div class="comment-body">
                    <div class="comment-content-wrapper">
                        <a href="/artist/${t.memberId}" class="writer">${t.memberNickname}</a>
                        <span class="comment-text">${t.content.replace(/\n/g,"<br>")}</span>
                    </div>
                    <div class="comment-meta-actions">
                        <span class="date">${r}${i}</span>
                        <button type="button" class="btn-action btn-reply-toggle">답글달기</button>
                        ${a}
                    </div>
                    ${t.replyCount&&t.replyCount>0?`<div class="replies-wrapper"><button class="btn-view-replies">답글 ${t.replyCount}개 보기</button></div>`:""}
                </div>
            </div>`},e=t=>{const n=t.memberId===k,r=A(t.createdTime),i=t.updatedTime&&JSON.stringify(t.createdTime)!==JSON.stringify(t.updatedTime)?'<span class="edited-badge">(수정됨)</span>':"",a=n?`<button type="button" class="btn-action btn-reply-edit">수정</button>
               <button type="button" class="btn-action btn-delete btn-reply-delete">삭제</button>`:"";let l=t.content.replace(/\n/g,"<br>");return t.targetMemberNickname&&(l=`<span class="mention-target">@${t.targetMemberNickname}</span> `+l),`
            <div class="reply-item" data-reply-id="${t.id}" data-member-id="${t.memberId}" style="display: flex; gap: 10px; margin-top: 12px;">
                <a href="/artist/${t.memberId}" class="reply-profile"><img src="${t.memberProfile}" alt="프사" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;"></a>
                <div class="reply-body" style="flex: 1;">
                    <div class="reply-content-wrapper">
                        <a href="/artist/${t.memberId}" class="writer" style="font-weight: 600; font-size: 0.9rem; color: #333; text-decoration: none; margin-right: 6px;">${t.memberNickname}</a>
                        <span class="reply-text" style="font-size: 0.9rem; color: #333;">${l}</span>
                    </div>
                    <div class="reply-meta-actions" style="margin-top: 4px; font-size: 0.75rem; color: #999;">
                        <span class="date">${r}${i}</span>
                        <button type="button" class="btn-action btn-nested-reply">답글</button>
                        ${a}
                    </div>
                </div>
            </div>`},o=()=>{if(w||!$)return;w=!0;const t={feedId:H,size:h};v!==null&&(t.lastCommentId=v),s.ajax({url:"/api/v1/comments/list",type:"GET",data:t,success:n=>{const r=n.content||[];if($=n.hasNext,(!r||r.length===0)&&v===null)N.html('<div class="empty-message">첫 번째 댓글을 남겨보세요!</div>'),u.hide();else if(r.length>0){let i="";r.forEach(a=>i+=q(a)),v===null?N.html(i):N.append(i),v=r[r.length-1].id}u.toggle($),w=!1},error:n=>{console.error("댓글 로드 실패",n),w=!1}})};x.off("input").on("input",function(){const t=s(this).val();O.prop("disabled",t.trim().length===0),this.style.height="auto",this.style.height=this.scrollHeight+"px"}),O.off("click").on("click",()=>{const t=x.val().trim();if(!t)return;const n="temp_"+Date.now(),r=new Date().toISOString(),a=q({id:n,memberId:k,memberNickname:g,memberProfile:j,content:t,createdTime:r,updatedTime:r,replyCount:0});N.prepend(a);const l=N.find(`[data-comment-id="${n}"]`);l.css("background-color","#f0f8ff").animate({backgroundColor:"#fff"},1e3),x.val("").css("height","auto").trigger("input"),_(1),s(".empty-message").remove(),s.ajax({url:"/api/v1/comments",type:"POST",contentType:"application/json",data:JSON.stringify({feedId:H,writerId:P,content:t}),success:c=>{l.attr("data-comment-id",c),l.data("comment-id",c)},error:()=>{l.remove(),_(-1),I.error("댓글 작성에 실패했습니다.")}})}),u.off("click").on("click",()=>{$&&!w&&o()}),s(document).off("click",".btn-comment-delete").on("click",".btn-comment-delete",function(){const t=s(this).closest(".comment-item"),n=t.data("comment-id");B.open({title:"댓글 삭제",desc:"정말 삭제하시겠습니까?",actionText:"삭제",onConfirm:()=>{if(String(n).startsWith("temp_")){t.remove(),_(-1);return}s.ajax({url:`/api/v1/comments/${n}`,type:"DELETE",success:()=>{t.slideUp(200,function(){s(this).remove()}),_(-1)},error:()=>I.error("삭제 실패")})}})}),s(document).off("click",".btn-comment-edit").on("click",".btn-comment-edit",function(){const t=s(this).closest(".comment-item"),n=t.find(".comment-content-wrapper");if(t.find(".edit-input-box").length>0)return;const r=(n.find(".comment-text").html()||"").replace(/<br\s*\/?>/gi,`
`);n.find(".comment-text").hide(),s(this).hide();const i=`
            <div class="edit-input-box" style="margin-top: 8px;">
                <textarea class="reply-textarea edit-textarea" rows="1">${r}</textarea>
                <div class="edit-actions" style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px;">
                    <button type="button" class="btn-action btn-edit-cancel">취소</button>
                    <button type="button" class="btn-reply-submit btn-edit-save">저장</button>
                </div>
            </div>
        `;n.append(i)}),s(document).off("click",".btn-edit-cancel").on("click",".btn-edit-cancel",function(){const t=s(this).closest(".comment-content-wrapper");t.find(".edit-input-box").remove(),t.find(".comment-text").show(),t.closest(".comment-item").find(".btn-comment-edit").show()}),s(document).off("click",".btn-edit-save").on("click",".btn-edit-save",function(){const t=s(this).closest(".comment-content-wrapper"),n=t.closest(".comment-item"),r=n.data("comment-id"),i=t.find(".edit-textarea").val().trim();if(!i)return I.error("내용을 입력하세요");s.ajax({url:`/api/v1/comments/${r}`,type:"PATCH",contentType:"application/json",data:JSON.stringify({content:i}),success:()=>{t.find(".comment-text").html(i.replace(/\n/g,"<br>")).show(),t.find(".edit-input-box").remove(),n.find(".btn-comment-edit").show(),n.find(".edited-badge").length===0&&n.find(".comment-meta-actions .date").append('<span class="edited-badge">(수정됨)</span>')},error:()=>I.error("수정 실패")})}),s(document).off("click",".btn-reply-toggle").on("click",".btn-reply-toggle",function(){const t=s(this).closest(".comment-item");if(t.find(".re-reply-form").length>0){t.find(".re-reply-form").remove();return}const r=`
            <div class="re-reply-form">
                <div class="reply-input-box small">
                    <textarea class="reply-textarea re-reply-input" placeholder="답글 입력..." rows="1"></textarea>
                    <button type="button" class="btn-reply-submit btn-re-reply-write" data-parent-id="${t.data("comment-id")}" disabled>게시</button>
                </div>
            </div>
        `;t.find(".comment-body").append(r),t.find(".re-reply-input").trigger("focus")}),s(document).off("input",".re-reply-input").on("input",".re-reply-input",function(){const t=s(this).val();s(this).next(".btn-re-reply-write").prop("disabled",t.trim().length===0),this.style.height="auto",this.style.height=this.scrollHeight+"px"}),s(document).off("click",".btn-re-reply-write").on("click",".btn-re-reply-write",function(){const t=s(this),n=t.closest(".re-reply-form"),r=n.find(".re-reply-input"),i=t.closest(".comment-item"),a=t.data("parent-id"),l=i.data("member-id"),c=t.data("target-member-id")||null,p=r.val().trim();if(!p)return;t.prop("disabled",!0);const d="temp_reply_"+Date.now(),m=new Date().toISOString();let b=null,y=p;if(c){const S=p.match(/^@(\S+)\s/);S&&(b=S[1],y=p.replace(/^@\S+\s+/,""))}const G={id:d,memberId:k,memberNickname:g,memberProfile:j,targetMemberNickname:b,content:y,createdTime:m,updatedTime:m};let E=i.find(".replies-wrapper");E.length===0&&(E=s('<div class="replies-wrapper"></div>'),i.find(".comment-body").append(E));let C=E.find(".re-reply-list");C.length===0&&(C=s('<div class="re-reply-list" style="margin-top: 10px; padding-left: 20px;"></div>'),E.append(C)),C.append(e(G)),C.show(),n.remove();const D=E.find(".btn-view-replies");if(D.length>0){const S=parseInt(D.text().replace(/[^0-9]/g,""),10)||0;D.text(`답글 ${S+1}개 보기`)}s.ajax({url:"/api/v1/replies",type:"POST",contentType:"application/json",data:JSON.stringify({commentId:a,parentMemberId:l,targetMemberId:c,feedId:H,feedWriterId:P,content:y}),success:S=>{const W=C.find(`[data-reply-id="${d}"]`);W.attr("data-reply-id",S),W.data("reply-id",S)},error:()=>{C.find(`[data-reply-id="${d}"]`).remove(),I.error("답글 작성 실패")}})}),s(document).off("click",".btn-nested-reply").on("click",".btn-nested-reply",function(){const t=s(this).closest(".reply-item"),n=s(this).closest(".comment-item"),r=t.data("member-id"),i=t.find(".writer").text();n.find(".re-reply-form").length===0&&n.find(".btn-reply-toggle").trigger("click");const a=n.find(".re-reply-form"),l=a.find(".re-reply-input"),c=a.find(".btn-re-reply-write");l.val(`@${i} `).trigger("focus"),c.data("target-member-id",r)}),s(document).off("click",".btn-view-replies").on("click",".btn-view-replies",function(){const t=s(this),n=t.closest(".replies-wrapper"),r=t.closest(".comment-item").data("comment-id");if(n.find(".re-reply-list").length>0){n.find(".re-reply-list").toggle();return}t.text("로딩 중..."),s.ajax({url:"/api/v1/replies",type:"GET",data:{commentId:r},success:i=>{const a=s('<div class="re-reply-list" style="margin-top: 10px; padding-left: 20px;"></div>');i&&i.length>0&&i.forEach(l=>a.append(e(l))),n.append(a),t.hide()},error:()=>I.error("대댓글 로드 실패")})}),s(document).off("click",".btn-reply-edit").on("click",".btn-reply-edit",function(){const t=s(this).closest(".reply-item"),n=t.find(".reply-content-wrapper");if(t.find(".edit-input-box").length>0)return;const r=n.find(".reply-text").clone();r.find(".mention-target").remove();const i=(r.html()||"").replace(/<br\s*\/?>/gi,`
`).trim();n.find(".reply-text").hide(),s(this).hide();const a=`
            <div class="edit-input-box" style="margin-top: 8px;">
                <textarea class="reply-textarea edit-reply-textarea" rows="1">${i}</textarea>
                <div class="edit-actions" style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px;">
                    <button type="button" class="btn-action btn-reply-edit-cancel">취소</button>
                    <button type="button" class="btn-reply-submit btn-reply-edit-save">저장</button>
                </div>
            </div>
        `;n.append(a)}),s(document).off("click",".btn-reply-edit-cancel").on("click",".btn-reply-edit-cancel",function(){const t=s(this).closest(".reply-content-wrapper");t.find(".edit-input-box").remove(),t.find(".reply-text").show(),t.closest(".reply-item").find(".btn-reply-edit").show()}),s(document).off("click",".btn-reply-edit-save").on("click",".btn-reply-edit-save",function(){const t=s(this).closest(".reply-content-wrapper"),n=t.closest(".reply-item"),r=n.data("reply-id"),i=t.find(".edit-reply-textarea").val().trim();if(!i)return I.error("내용 입력 필요");s.ajax({url:`/api/v1/replies/${r}`,type:"PATCH",contentType:"application/json",data:JSON.stringify({content:i}),success:()=>{const a=t.find(".reply-text"),l=a.find(".mention-target");let c=i.replace(/\n/g,"<br>");l.length>0&&(c=l.prop("outerHTML")+" "+c),a.html(c).show(),t.find(".edit-input-box").remove(),n.find(".btn-reply-edit").show(),n.find(".edited-badge").length===0&&n.find(".reply-meta-actions .date").append('<span class="edited-badge">(수정됨)</span>')},error:()=>I.error("수정 실패")})}),s(document).off("click",".btn-reply-delete").on("click",".btn-reply-delete",function(){const t=s(this).closest(".reply-item"),n=t.data("reply-id");B.open({title:"답글 삭제",desc:"정말 삭제하시겠습니까?",actionText:"삭제",onConfirm:()=>{if(String(n).startsWith("temp_")){t.remove();return}s.ajax({url:`/api/v1/replies/${n}`,type:"DELETE",success:()=>{const r=t.closest(".replies-wrapper");t.slideUp(200,function(){s(this).remove();const i=r.find(".btn-view-replies");if(i.length>0){const a=parseInt(i.text().replace(/[^0-9]/g,""),10)||0;a>0&&i.text(`답글 ${a-1}개 보기`)}})},error:()=>I.error("삭제 실패")})}})}),s(document).off("input",".edit-textarea, .edit-reply-textarea").on("input",".edit-textarea, .edit-reply-textarea",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),o()}export{rt as i};
